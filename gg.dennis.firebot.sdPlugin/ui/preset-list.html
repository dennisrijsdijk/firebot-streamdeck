<!DOCTYPE html>
<html>

<head lang="en">
    <title>Increment Counter Settings</title>
    <meta charset="utf-8" />
    <script src="sdpi-components.js"></script>
    <script src="ui-globals.js"></script>
    <style>
        hr2,
        .sdpi-heading {
            --sdpi-bgcolor: #2D2D2D;
            --sdpi-background: #3D3D3D;
            --sdpi-color: #d8d8d8;
            --sdpi-bordercolor: #3a3a3a;
            --sdpi-buttonbordercolor: #969696;
            --sdpi-borderradius: 0px;
            --sdpi-width: 224px;
            --sdpi-fontweight: 600;
            --sdpi-letterspacing: -0.25pt;
            --sdpi-tab-color: #969696;
            --sdpi-tab-left-margin: 1px;
            --sdpi-tab-top-offset: 1px;
            --sdpi-tab-selected-color: #333333;
            --sdpi-tab-selected-top-offset: 0px;
            --sdpi-tab-font-size: 9pt;
            --sdpi-tab-container-left-offset: 5px;
            --sdpi-tab-padding-horizontal: 12px;
            --sdpi-tab-padding-vertical: 5px;
            --sdpi-linecolor: #454545;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            display: flex;
            flex-basis: 100%;
            align-items: center;
            color: inherit;
            font-size: 9pt;
            margin: 8px 0px;
            color: #9a9a9a;
        }

        .sdpi-heading::before,
        .sdpi-heading::after {
            content: "";
            flex-grow: 1;
            background: var(--sdpi-background);
            height: 1px;
            font-size: 0px;
            line-height: 0px;
            margin: 0px 16px;
        }
    </style>
</head>

<body>
    <sdpi-item id="instance-select-container" label="Instance" style="display: none;">
        <sdpi-select id="instance-select" setting="endpoint" datasource="getInstances" loading="Fetching Instances..." placeholder="Select an instance..." hot-reload></sdpi-select>
    </sdpi-item>

    <sdpi-item label="Title">
        <sdpi-textarea setting="title" placeholder="Enter title..." rows="2"></sdpi-textarea>
    </sdpi-item>
    <sdpi-item label="Preset Effect List">
        <sdpi-select setting="action.id" datasource="getPresetLists"
            loading="Fetching Preset Effect Lists..." placeholder="Select a preset effect list..." show-refresh
            hot-reload>
        </sdpi-select>
    </sdpi-item>
    <div class="sdpi-heading">Preset List Arguments</div>
    <div id="preset-list-args"></div>

    <sdpi-item>
        <div style="display: flex; gap: 8px;">
            <sdpi-button onclick="openInstanceManagementWindow()" style="flex: 1;">Instances</sdpi-button>
            <sdpi-button onclick="openVariablesExplorerWindow()" style="flex: 1;">Variables</sdpi-button>
        </div>
    </sdpi-item>
</body>

<script>
    (async function () {
        SDPIComponents.streamDeckClient.sendToPropertyInspector.subscribe((ev) => {
            if (ev.payload.event === "getPresetListArgs") {
                const argumentsList = ev.payload.items;
                const argsContainer = document.getElementById("preset-list-args");
                const existingItems = new Set(Array.from(argsContainer.querySelectorAll("sdpi-item")).map(item => item.getAttribute("label")));

                // Remove items that are not in the new input
                for (const item of argsContainer.querySelectorAll("sdpi-item")) {
                    const label = item.getAttribute("label");
                    if (!argumentsList.includes(label)) {
                        item.remove();
                    }
                }

                // Add new items that don't already exist
                for (const arg of argumentsList) {
                    if (!existingItems.has(arg.label)) {
                        const item = document.createElement("sdpi-item");
                        item.setAttribute("label", arg.label);

                        const textField = document.createElement("sdpi-textfield");
                        textField.setAttribute("setting", `action.arguments.${arg.label}`);

                        textField.value = arg.value || "";

                        item.appendChild(textField);
                        argsContainer.appendChild(item);
                    }
                }
            }
        });
        await initializeUiGlobals();
    })();
</script>

</html>